import streamlit as st
import streamlit.components.v1 as components

# Make page use full width
st.set_page_config(page_title="WYSIWYG HTML Editor", layout="wide")

# All of our editorâ€™s HTML/CSS/JS in one string
html_content = r"""
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WYSIWYG HTML Editor</title>
  <style>
    body { margin:0; font-family:Segoe UI, sans-serif; }
    .toolbar {
      padding:10px; background:#f5f5f5; border-bottom:1px solid #ccc;
      display:flex; flex-wrap:wrap; gap:8px; align-items:center;
    }
    .toolbar button, .toolbar select, .toolbar input {
      font-size:12px; padding:4px; cursor:pointer;
    }
    .toolbar .table-props {
      margin-left:auto; display:flex; gap:6px; align-items:center;
    }
    .editor-container { display:flex; height:calc(100vh - 50px); }
    .panel {
      flex:1; display:flex; flex-direction:column; border-right:1px solid #ddd;
    }
    .panel:last-child { border-right:none; }
    .panel-header {
      background:#e8e8e8; padding:8px; font-weight:bold; border-bottom:1px solid #ccc;
    }
    .editor, textarea {
      flex:1; padding:10px; border:none; outline:none;
      font-family:inherit; font-size:14px; line-height:1.4;
      resize:none;
    }
    textarea { background:#fafafa; border-top:1px solid #ddd; }
    table.selected { outline:2px solid #007acc !important; }
    .controls { display:none; position:absolute; background:#fff; padding:10px; border:1px solid #007acc; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
    .controls input { width:100%; margin-bottom:8px; }
  </style>
</head>
<body>
  <div class="toolbar">
    <button onclick="exec('bold')"><b>B</b></button>
    <button onclick="exec('italic')"><i>I</i></button>
    <button onclick="exec('underline')"><u>U</u></button>
    <select onchange="exec('formatBlock', this.value)">
      <option value="">Format</option>
      <option value="h1">H1</option>
      <option value="h2">H2</option>
      <option value="p">P</option>
    </select>
    <button onclick="exec('insertUnorderedList')">&bull; UL</button>
    <button onclick="exec('insertOrderedList')">1. OL</button>
    <button onclick="insertTable()">Table</button>
    <div class="table-props">
      W:<input type="number" id="propW" placeholder="px" min="1">
      B:<input type="number" id="propB" min="0">
      CS:<input type="number" id="propCS" min="0">
      CP:<input type="number" id="propCP" min="0">
      <button id="applyProps">Apply</button>
    </div>
  </div>

  <div class="editor-container">
    <div class="panel">
      <div class="panel-header">Visual</div>
      <div id="visual" class="editor" contenteditable="true"></div>
    </div>
    <div class="panel">
      <div class="panel-header">HTML</div>
      <textarea id="code" class="editor"></textarea>
    </div>
  </div>

  <script>
    const vis = document.getElementById('visual');
    const code = document.getElementById('code');
    let selTable = null;

    function exec(cmd, val=null){
      document.execCommand(cmd, false, val);
      syncToCode();
    }
    function syncToCode(){
      code.value = vis.innerHTML;
    }
    function syncToVis(){
      vis.innerHTML = code.value;
    }
    vis.addEventListener('input', syncToCode);
    code.addEventListener('input', syncToVis);

    // Table insertion
    function insertTable(){
      const r = parseInt(prompt('Rows','2'),10);
      const c = parseInt(prompt('Cols','2'),10);
      if(r>0&&c>0){
        let t='<table border="1" cellspacing="0" cellpadding="4">';
        for(let i=0;i<r;i++){
          t+='<tr>';
          for(let j=0;j<c;j++){
            t+='<td>Cell</td>';
          }
          t+='</tr>';
        }
        t+='</table>';
        exec('insertHTML', t);
      }
    }

    // Click to select table
    vis.addEventListener('click', e=>{
      document.querySelectorAll('table').forEach(t=>t.classList.remove('selected'));
      const t = e.target.closest('table');
      if(t){
        selTable = t;
        t.classList.add('selected');
        // populate props
        document.getElementById('propW').value = t.getAttribute('width')||'';
        document.getElementById('propB').value = t.getAttribute('border')||'';
        document.getElementById('propCS').value= t.getAttribute('cellspacing')||'';
        document.getElementById('propCP').value= t.getAttribute('cellpadding')||'';
      }
    });

    // Apply props
    document.getElementById('applyProps').onclick = ()=>{
      if(!selTable) return;
      const w = document.getElementById('propW').value;
      const b = document.getElementById('propB').value;
      const cs= document.getElementById('propCS').value;
      const cp= document.getElementById('propCP').value;
      if(w) selTable.setAttribute('width', w);
      if(b) selTable.setAttribute('border', b);
      if(cs) selTable.setAttribute('cellspacing', cs);
      if(cp) selTable.setAttribute('cellpadding', cp);
      syncToCode();
    };

    // Initialize
    vis.innerHTML = '<p>Start writing...</p>';
    syncToCode();
  </script>
</body>
</html>
"""

# Render the editor in Streamlit
components.html(html_content, height=800, scrolling=True)
